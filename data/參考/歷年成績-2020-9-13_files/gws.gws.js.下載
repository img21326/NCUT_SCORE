
﻿;(function(d){d.extend({PreventDefault:function(event,type){var e=event||window.event;var key=d.GetKeyCode(e);if(type=='all'){if(e&&e.preventDefault){e.preventDefault();}else if(window.event){window.event.returnValue=false;}}else if(type=='enter'){if(key!==13){if(e&&e.preventDefault){e.preventDefault();}else if(window.event){window.event.returnValue=false;}}}else{if(key!==37&&key!==38&&key!==39&&key!==40){if(e&&e.preventDefault){e.preventDefault();}else if(window.event){window.event.returnValue=false;}}}},Round:function(number,fractionDigits){with(Math){return round(number*pow(10,fractionDigits))/pow(10,fractionDigits);}},ObjectKeys:function(){return Object.keys||(function(){var hasOwnProperty=Object.prototype.hasOwnProperty;var hasDontEnumBug=!{toString:null}.propertyIsEnumerable('toString');var dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;return function(o){if(typeof o!='object'&&typeof o!='function'||o===null)
throw new TypeError('Object.keys called on a non-object');var result=[];for(var name in o){if((d.user.prototypeDebug==true)&&(!o.hasOwnProperty(name)))continue;if(hasOwnProperty.call(o,name))
result.push(name);}
if(hasDontEnumBug){for(var i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(o,dontEnums[i]))
result.push(dontEnums[i]);}}
return result;};})();},InsertAfter:function(target,node){target.parentNode.insertBefore(node,target.nextSibling);},GetTime:function(){var NowDate=new Date();var h=NowDate.getHours();var m=NowDate.getMinutes();var s=NowDate.getSeconds();return h+'時'+m+'分'+s+'秒';},GetObjectSize:function(obj){var size=0;for(var key in obj){if(d.user.prototypeDebug==true&&!obj.hasOwnProperty(key))continue;if(obj.hasOwnProperty(key))size++;}
return size;},GetKeyCode:function(event){return Number(window.event?event.keyCode:event.which);},GetForm:function(elem){var Main=function(parent,arr){if(typeof(parent)=='undefined')return;parent=typeof(parent.length)!='undefined'?parent:[parent];for(var i=0;i<parent.length;i++){child=parent[i];if(typeof(child)==='undefined')continue;if(d.user.passHidden==true&&d.isHidden(child)==true&&d.GetClass(child,'dcw-emluator','fuzzy')==false)continue;if(child.nodeType===3){}else if(((child.nodeName).toUpperCase()=='INPUT'&&((child.type).toUpperCase()=='TEXT'))||((child.nodeName).toUpperCase()=='TEXTAREA')){arr.push(child);}else if(child.className=='dcw-emluator-input'){arr.push(child);}else if((child.nodeName).toUpperCase()!='SCRIPT'){arr=Main(child.childNodes,arr);}}
return arr;}
return Main(elem,[]);},GetResponseText:function(xhr,Callback){xhr.send();if(typeof(Callback)==='function'){xhr.onload=xhr.onreadystatechange=function(){if(document.dispatchEvent||/loaded|complete/i.test(xhr.readyState)){Callback(xhr.responseText);this.onload=this.onreadystatechange=null;}}}else{if(async==false){return xhr.responseText;}
else{xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200)return xhr.responseText;}}}}},CreateXmlHttpRequest:function(){if(window.ActiveXObject){try{return new ActiveXObject('Msxml2.XMLHTTP');}
catch(e){try{return new ActiveXObject('Microsoft.XMLHTTP');}
catch(E){return null;}}}
else if(window.XMLHttpRequest)return new XMLHttpRequest();　　else return'null';},SendXmlHttpRequest:function(url,method,async,data,Callback){var xhr=d.CreateXmlHttpRequest();xhr.open(method,url,async);xhr.send(data);if(typeof(Callback)==='function'){xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200)Callback(xhr);}}}
return xhr;},DeleteDuplicates:function(arr){var i,j,cur,found;for(i=arr.length-1;i>=0;i--){cur=arr[i];found=false;for(j=i-1;!found&&j>=0;j--){if(cur===arr[j]){if(i!==j){arr.splice(i,1);}
found=true;}}}
return arr;},DeleteDuplicates2:function(arr){arr.sort();for(var i=1;i<arr.length;){if(arr[i-1]==arr[i]){arr.splice(i,1);}else{i++;}}
return arr;},DeleteEmpty:function(arr){var arr2=[];for(var i in arr){if(d.user.prototypeDebug==true&&!arr.hasOwnProperty(i))continue;if(arr[i])arr2.push(arr[i]);}
return arr2;},CreateClass:function(target,classValue){if(typeof(target)==='undefined')return;var pattern=new RegExp('(^| )'+classValue+'( |$)');if(target!=null&&!pattern.test(target.className)){if(target.className=='')
target.className=classValue;else
target.className+=' '+classValue;}
return true;},DeleteClass:function(target,classValue,type){if(target==null||typeof(target.className)=='undefined'||target.className.length==0)return;var removedClass=target.className;if(type=='fuzzy'){var pattern=new RegExp('(^| )'+classValue+'.*?'+'( |$)');}else{var pattern=new RegExp('(^| )'+classValue+'( |$)');}
removedClass=removedClass.replace(pattern,'$1');removedClass=removedClass.replace(/ $/,'');target.className=removedClass;return true;},GetClass:function(target,classValue,type){if(!target)return;var getClass=target.className;if(type=='fuzzy'){var pattern=new RegExp(classValue);}else{var pattern=new RegExp('(^| )'+classValue+'( |$)');}
if(getClass.match(pattern))return true;else return false;},DOM:function(elem,type){type=type?type:null;if(type=='id'||elem.indexOf('#')==0){elem=elem.replace('#','');return document.getElementById(elem);}else if(type=='class'||elem.indexOf('.')==0){elem=elem.replace('.','');if(!document.getElementsByClassName||(d.user.prototypeDebug==true&&(d.glob.browser=='IE8'||d.glob.browser=='IE7'))){var indexOf=[].indexOf||function(prop){for(var i=0;i<this.length;i++){if(this[i]===prop)return i;}
return-1;}
getElementsByClassName=function(className,context){var elems=document.querySelectorAll?context.querySelectorAll('.'+className):(function(){var all=context.getElementsByTagName('*'),elements=[],i=0;for(;i<all.length;i++){if(all[i].className&&(' '+all[i].className+' ').indexOf(' '+className+' ')>-1&&indexOf.call(elements,all[i])===-1)elements.push(all[i]);}
return elements;})();return elems;}
return getElementsByClassName(elem,document);}else{return document.getElementsByClassName(elem)}}else{if(document.getElementsByTagName(elem).length<2){return document.getElementsByTagName(elem)[0]}else{return document.getElementsByTagName(elem)}}},Trim:function(){return arguments[0].replace(/^\s*|\s*$/g,'');},Offset:function(self){self=self?self:this;var x=self.offsetLeft;var y=self.offsetTop;try{while(self=self.offsetParent){x+=self.offsetLeft;y+=self.offsetTop;}}catch(e){x=0;y=0;}
return{left:x,top:y};},IsEmptyObject:function(obj){for(var i in obj){if(typeof(d)!=undefined&&d.user.prototypeDebug==true&&!obj.hasOwnProperty(i))continue;return false;}
return true;},GetCaret:function(elem){var start,end,range;if(document.all){if(elem.nodeName.toUpperCase()=='INPUT'){if(elem.type!='text')return 0;elem.focus();range=document.selection.createRange();range.setEndPoint('StartToStart',elem.createTextRange());start=range.text.length;}else{elem.focus();range=document.selection.createRange();range_all=document.body.createTextRange();range_all.moveToElementText(elem);text=range.text;for(var i=0;range_all.compareEndPoints('StartToStart',range)<0&&range.moveStart('character',-1)!==0;i++){}
start=i;}}else{start=elem.selectionStart;end=elem.selectionEnd;}
return{start:start,end:end};},SetCaret:function(caret,target){if(target==null)return;if(document.all){var e=target.createTextRange();e.collapse(true);e.moveStart('character',caret);e.collapse(false);e.select();}else{target.selectionStart=caret;target.selectionEnd=caret;}},QuerySelector:function(str){if(document.querySelector)return document.querySelector(str);else if(document.querySelectorAll)return document.querySelectorAll(str);else{var s=document.createStyleSheet();document.querySelectorAll=function(r,c,i,j,a){var a=document.all,c=[],r=r.replace(/\[for\b/gi,'[htmlFor').split(',');for(var i=r.length;i--;){s.addRule(r[i],'k:v');for(var j=a.length;j--;)a[j].currentStyle.k&&c.push(a[j]);s.removeRule(0);}
return c;}
return document.querySelectorAll(str);}},CreateElement:function(){if(!arguments[0])return;var wrap=document.createElement('div');var fragment=document.createDocumentFragment();wrap.innerHTML=arguments[0];for(var node=wrap.firstChild,temp=node.nextSibling;node;){fragment.appendChild(node);node=temp;temp=node?node.nextSibling:null;}
wrap=null;return fragment;},ReplaceWith:function(elem,str){if(!str)return;if(typeof(str)==='object'){elem.parentNode.replaceChild(str,elem);return elem;}else if(typeof(str)==='string'){var newElem=d.CreateElement(str);if(elem.parentNode==null)return;elem.parentNode.insertBefore(newElem,elem);elem.parentNode.removeChild(elem);return elem;}},InsertScript:function(type,url,id){var elem;var head=document.head||document.getElementsByTagName('head')[0]||document.getElementsByTagName('head').item(0);if(type=='javascript'){d.DeleteNode(id,'head');elem=document.createElement('script');elem.type='text/javascript';elem.setAttribute('src',url);id!=null?elem.setAttribute('id',id):'';head.appendChild(elem);}
if(type=='css'){var style=document.getElementById(id.toString()+'style');if(style){d.DeleteNode(id.toString()+'style','head');}
if(document.getElementById(id)){elem=document.getElementById(id);if(elem.getAttribute('href')!=url){if(d.glob['browser']=='IE9'||d.glob['browser']=='IE8'){elem.type='';elem.setAttribute('href',url);elem.type='text/css';}else{elem.setAttribute('href',url);}}}else{elem=document.createElement('link');elem.type='text/css';elem.setAttribute('href',url);elem.setAttribute('media','all');elem.setAttribute('rel','stylesheet');id!=null?elem.setAttribute('id',id):'';head.appendChild(elem);if(d.glob['browser']=='IE8'||d.glob['browser']=='IE7'||d.glob['browser']=='IE6'){elem.type='';elem.setAttribute('href',url);elem.type='text/css';}}}
return elem;},DeleteNode:function(id,where){var elem=document.getElementById(id);if(elem){if(where=='head'){var parent=document.getElementsByTagName('head')[0];}else if(where=='body'){var parent=document.getElementsByTagName('body')[0];}
parent.removeChild(elem);}},CanListen:function(elem,classes){if(elem==null)return false;classes=classes?classes:d.user.noListenClass;var mismatch=false;if(typeof(elem.className)!=='undefined'){for(var i=0;i<classes.length;i++){if(elem.className.search(classes[i])>=0){mismatch=true;}}
if(mismatch)return false;}
return true;},ClearRandom:function(str){str=str.replace(/-\d+$/gi,'');return str;},CreateEvent:function(obj,type,func){if(obj==null)return;if(window.attachEvent){obj=obj==window?document:obj;if(type=='resize'){obj.attachEvent('onresize',function(){d.Debounce.apply(obj,func,300)});}else{if(arguments==null){obj.attachEvent('on'+type,func);}else{obj.attachEvent('on'+type,function(){func.apply(obj,arguments)});}}}else{obj.addEventListener(type,func,false);}},DeleteEvent:function(obj,type,func){if(obj==null)return;if(window.detachEvent){obj=obj==window?document:obj;obj.detachEvent('on'+type,function(){func.apply(obj,arguments)});}else obj.removeEventListener(type,func,false);},Pic2Str:function(str){if(d.user['showType']=='string'){var elem=document.createElement('div');elem.innerHTML=str;return elem.innerText;}else{var reg;if(d.user['showType']=='span')reg=new RegExp('<span[^<|>]+data-font="?([^<|>| |"]+)"?[^<|>]+><span[^<|>]+>[^<|>]+</span></span>',"gi");if(d.user['showType']=='image')reg=new RegExp('<img[^<|>]+alt="?([^<|>| |"]+)"?[^<|>]+>',"gi");str=str.replace(reg,'$1')
var elem=document.createElement('div');elem.innerHTML=str;return elem.innerText;}},ClearU3000:function(html){html=html.replace('　','');return html;},Filter:function(html){var reg=new RegExp('(<span[^<|>]+><span[^<|>]+>)([^<|>]+)(</span></span>)','gi');html=html.replace(reg,'$1$3$2');return html;},Copy:function(){if(d.user['showType']=='string'){}else{event.returnValue=false;var str=document.selection.createRange().htmlText;if(str==null)return;if(d.user['showType']=='span')reg=new RegExp('<span[^<|>]+data-font="?([^<|>| |"]+)"?[^<|>]+><span[^<|>]+>[^<|>]+</span></span>','gi');if(d.user['showType']=='image')reg=new RegExp('<img[^<|>]+alt="?([^<|>| |"]+)"?[^<|>]+>','gi');str=str.replace(reg,'$1')
var elem=document.getElementById('dcw-temp-copy');elem.innerHTML=str;window.clipboardData.setData('Text',elem.innerText);}},Paste:function(){if(d.user.emluator.enable!=true)return;var elem=document.getElementById('dcw-temp-copy');elem.innerHTML=window.clipboardData.getData('Text');window.clipboardData.setData('Text',elem.innerText);},SaveEvent:function(elem1,elem2,events){events=events?events:d.user.saveEvent;for(var i in events){if(elem2['on'+events[i]]!=null){d.CreateEvent(elem1,events[i],elem2['on'+events[i]]);}}}});d.extend({SetFontFaceAll:function(code){d.user.code={'wfa':code,'wime':code,'ppwime':code}
d.StartGWS();},Replay:function(){if(typeof(event)!='undefined'){if(d.user.prevent==true)d.PreventDefault(event,'all');}
if(d.glob['state']!=='Finish')return;d.StartGWS();},replay:function(){if(typeof(event)!='undefined'){if(d.user.prevent==true)d.PreventDefault(event,'all');}
if(d.glob['state']!=='Finish')return;d.StartGWS();}});d.extend({Log:function(str,level){if(typeof(str)==='array')str=str.join('\n');if(level=='show'){console.log(str);return;}
level=level?level:0;if((d.user['isDebug']===false)||(d.user.logLevel<level)){return;}else if(d.user['isDebug']=='console'&&window.console){console.log(str);}else if(d.user['isDebug']=='alert'){alert(str);}},SetMirrorsPosition:function(){var data=arguments[0];for(var i=0;i<data['elem'].length;i++){if((data['target']==undefined&&data['align']=='target')||data['elem'][i]==undefined)return;var elem=data['elem'][i];switch(data['align']){case'body':switch(data['position']){case'top-left':elem.style.top=0+data['top']+'px';elem.style.left=0+data['left']+'px';break;case'top-right':elem.style.top=0+data['top']+'px';elem.style.right=0+data['left']+'px';break;case'bottom-left':elem.style.bottom=0+data['top']+'px';elem.style.left=0+data['left']+'px';break;case'bottom-right':elem.style.bottom=0+data['top']+'px';elem.style.right=0+data['left']+'px';break;}
elem.style.position='fixed';break;case'target':var target={left:d.GetPos(data['target'],'X'),top:d.GetPos(data['target'],'Y'),width:data['target'].offsetWidth,height:data['target'].offsetHeight}
var elem2={top:null,left:null,width:elem.offsetWidth,height:elem.offsetHeight}
switch(data['position']){case'top-left':elem2={top:target.top-elem2.height,left:target.left}
break;case'top-right':elem2={top:target.top-elem2.height,left:target.left+target.width-elem2.width}
break;case'bottom-left':elem2={top:target.top+target.height,left:target.left}
break;case'bottom-right':elem2={top:target.top+target.height,left:target.left+target.width-elem2.width}
break;}
var screenWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var screenHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var screentop=document.body.scrollTop||document.documentElement.scrollTop;var screenleft=document.documentElement.scrollLeft||document.body.scrollLeft;if((elem2.top+data['top']<0||elem2.left+data['left']<0)||(elem2.top+data['top']<screentop||elem2.left+data['left']<screenleft)||d.user.overflowCenter==true&&elem2.top+data['top']+elem.offsetHeight>=screentop+screenHeight||elem2.left+data['left']+elem.offsetWidth>=screenleft+screenWidth){d.SetCenter(elem)}else{elem.style.position='absolute';elem.style.top=elem2.top+data['top']+'px';elem.style.left=elem2.left+data['left']+'px';}
d.Log(' + Position: '+elem.id+' Abs: '+elem.style.top+', '+elem.style.left,2);break;}}},SetCenter:function(elem){var centerX,centerY;var divWidth=elem.offsetWidth;var divHeight=elem.offsetHeight;if(self.innerHeight){centerX=self.innerWidth;centerY=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){centerX=document.documentElement.clientWidth;centerY=document.documentElement.clientHeight;}else if(document.body){centerX=document.body.clientWidth;centerY=document.body.clientHeight;}
var offsetLeft=(centerX-divWidth)/2;var offsetTop=(centerY-divHeight)/2;elem.style.top=offsetTop+'px';elem.style.left=offsetLeft+'px';},CreateMuchEvent:function(){var data=arguments[0];if(data['node'])
var elems=data['node'];else
return;for(var i in data){if(d.user.prototypeDebug==true&&!data.hasOwnProperty(i))continue;if(i==='node')continue;for(var j=0;j<elems.length;j++){var elem=typeof(elems[j])==='string'?d.DOM(elems[j]):elems[j];if((Object.prototype.toString.call(elem)==='[object]')||(Object.prototype.toString.call(elem)==='[object Array]')||(Object.prototype.toString.call(elem)==='[object NodeList]')||(Object.prototype.toString.call(elem)==='[object HTMLCollection]')||(Object.prototype.toString.call(elem)==='[object Object]')){if(elem.length>0){for(var k=0;k<elem.length;k++){if(data[i]&&d.CanListen(elem[k]))d.CreateEvent(elem[k],i,data[i]);}}else{if(data[i]&&d.CanListen(elem))d.CreateEvent(elem,i,data[i]);}}else{if(data[i]&&d.CanListen(elem))d.CreateEvent(elem,i,data[i]);}}}
return false;},DeleteMuchEvent:function(){var data=arguments[0];if(data['node'])
var elems=data['node'];else
return
for(var i in data){if(d.user.prototypeDebug==true&&!data.hasOwnProperty(i))continue;if(i==='node')continue;for(var j=0;j<elems.length;j++){var elem=typeof(elems[j])==='string'?d.DOM(elems[j]):elems[j];if((Object.prototype.toString.call(elem)==='[object]')||(Object.prototype.toString.call(elem)==='[object Array]')||(Object.prototype.toString.call(elem)==='[object NodeList]')||(Object.prototype.toString.call(elem)==='[object HTMLCollection]')||(Object.prototype.toString.call(elem)==='[object Object]')){for(var k=0;k<elem.length;k++){if(elem.length>0){for(var k=0;k<elem.length;k++){if(data[i]&&d.CanListen(elem[k]))d.DeleteEvent(elem[k],i,data[i]);}}else{if(data[i]&&　d.CanListen(elem))d.DeleteEvent(elem[k],i,data[i]);}}}else{if(data[i]&&d.CanListen(elem))d.DeleteEvent(elem,i,data[i]);}}}
return false;},GetIME:function(target,className){var classVal=target.className;var reg=new RegExp('(^| )'+className+'(.*?)( |$)');return classVal.match(reg)?classVal.match(reg)[2]:false;},SetFontFace:function(){var setting=arguments[0];if(!setting['target'])return;if(typeof(setting['target'].length)=='undefined'){if(d.user.defaultFontFace!=false){setting['target'].style.fontFamily=d.user.defaultFontFace+','+setting['fontface'];}else{setting['target'].style.fontFamily=setting['fontface'];}}
for(var i=0;i<setting['target'].length;i++){if(typeof(setting['target'][i])!=='object')continue;if(d.user.defaultFontFace!=false){setting['target'][i].style.fontFamily=d.user.defaultFontFace+','+setting['fontface'];}else{setting['target'][i].style.fontFamily=setting['fontface'];}}},Rename:function(type,name){switch(type){case'temp':return d.user.sign['dcw']+d.user.sign['temp']+name;break;}},SetState:function(state,elem){elem=elem?elem:document.getElementById(d.user['stateID']);d.glob['state']=state;d.glob.stateLog.push(d.glob['state']);if(elem){elem.innerHTML=d.glob['state'];}},isVisible:function(el,isDeep){var elIsVisible=true;if("undefined"===typeof isDeep){isDeep=true;}
elIsVisible=elIsVisible&&el.offsetWidth>0&&el.offsetHeight>0;if(isDeep&&elIsVisible){while('BODY'!=el.tagName&&elIsVisible){elIsVisible=elIsVisible&&'hidden'!=d.GetStyle(el,"visibility");el=el.parentElement;}}
return elIsVisible;},Camelize:function(str){return str.replace(/\-(\w)/g,function(str,letter){return letter.toUpperCase();});},GetStyle:function(elem,styleProp){if(elem.nodeType==3)return false;if(elem.nodeName=="#comment")return false;if(styleProp){if(elem.currentStyle){return elem.currentStyle[d.Camelize(styleProp)];}else if(document.defaultView&&document.defaultView.getComputedStyle){return document.defaultView.getComputedStyle(elem,null).getPropertyValue(styleProp);}else{return elem.style[d.Camelize(styleProp)];}}else{if(elem.currentStyle){return elem.currentStyle;}else if(document.defaultView&&document.defaultView.getComputedStyle){return document.defaultView.getComputedStyle(elem,null);}else{return elem.style;}}},isHidden:function(el){var w=el.offsetWidth,h=el.offsetHeight,force=(el.tagName==='TR'&&el.tagName==='OPTION'&&el.tagName==='OPTGROUP');return(w===0&&h===0&&!force)?true:(w!==0&&h!==0&&!force)?(d.GetStyle(el,'visibility')==='hidden'?true:d.GetStyle(el,'display')==='none'?true:false):false;},SetTemplate:function(type,id,default_elem,temp_elem){var elem=document.getElementById(d.user.sign['dcw']+d.user.sign['temp']+id)||'';var temp;if(temp_elem){temp=temp_elem;}else{if(document.getElementById('dcw-temp')){temp=document.getElementById('dcw-temp');}else{temp=document.createElement('div');temp.id='dcw-temp';if(d.glob.devices!='MOBILE'&&d.user.mobileMode!=true)d.CreateClass(temp,d.user.sign.dcw+d.user.lang)
document.body.appendChild(temp);}}
switch(type){case'add':if(!elem){elem=document.createElement('div');elem.id=d.user.sign['dcw']+d.user.sign['temp']+id;temp.appendChild(elem);}
if(default_elem){elem.appendChild(default_elem);}else{if(d.glob.target['ime']&&id==d.user.keyboard['id']){elem.innerHTML=d.html[d.user.IME[d.user.lang][d.glob.target['ime']]['keyboard']['id']];}else if(typeof(d.html[id])!='undefined'){elem.innerHTML=d.html[id];}
d.CreateClass(elem,d.user.hideClass);}
break;case'remove':if(!elem)return;if(d.glob['browser']=='IE8'||d.glob['browser']=='IE9'||d.glob['browser']=='IE10'){elem.outerHTML=' ';}else{temp.removeChild(elem);}
break;case'hide':if(!d.GetClass(elem,d.user.hideClass))d.CreateClass(elem,d.user.hideClass)
break;case'show':if(d.GetClass(elem,d.user.hideClass))d.DeleteClass(elem,d.user.hideClass)
break;case'state':return elem?(d.GetClass(elem,d.user.hideClass)?false:true):false;break;}
return false;},Info:function(){var log=['# GaijiWeb Server Javascript Plugin',' + Version: '+d.fn.version,' + Path: '+d.glob['url'],' + Language: '+d.user.lang,' + Full CSS for Web: '+d.user.webFullCSS,' + Full CSS for IME: '+d.user.imeFullCSS,' + Connect: '+d.user.queryType,' + Preprocessor: '+d.user.preprocessor,' + Unicode to BIG5: '+d.glob.features['unicode'],' + UAO to Gaiji: '+d.glob.features['uao'],' + Keyboard: '+d.glob.features['keyboard'],' + Re WFA: '+d.user.reWFA];console.log(log.join('\n'));},GetFeatures:function(){return{json:dynaRequire.file['json']&&d.user.queryType=='ajax'?true:false,unicode:dynaRequire.file['wfa']&&dynaRequire.file['unicode']&&d.user['lang']=='CHT'&&d.user.unicode2big5['enable']?d.user['compatibilityDebug']==true?d.GetObjectSize(JSON)>0:d.GetObjectSize(d.mapping['unicode'])>0:false,uao:dynaRequire.file['wfa']&&dynaRequire.file['uao']&&d.user['lang']=='CHT'?d.user['uao2gaiji']:false,hkscs:dynaRequire.file['wfa']&&dynaRequire.file['hkscs']&&d.user['lang']=='CHT'?d.user['hkscs2gaiji']:false,wfa:dynaRequire.file['wfa']?true:false,wime:dynaRequire.file['wime']?true:false,ppwime:(dynaRequire.file['ppwime']&&d.user.PPWIME['enable'])?true:false,keyboard:(dynaRequire.file['wime']&&d.user.keyboard['enable'])?(d.glob.devices=='MOBILE'||d.user.mobileMode==true?d.user.keyboard.mandatory['mobile']:d.user.keyboard.mandatory['desktop']):false}},Focus:function(type){if(d.glob.features['keyboard']===true){if(document.getElementById(d.user.WIME['compositionID']))document.getElementById(d.user.WIME['compositionID']).blur();}else{if(d.SetTemplate('state',d.user.WIME['id'])==false){if(d.glob.target['elem']!=null){d.SetCaret(d.glob.target['caret'],d.glob.target['elem']);d.glob.target['elem'].blur();d.glob.target['elem'].focus();}}}
if(type=='keyboard'){if(d.IsHere('keyboard')){document.getElementById(d.user.WIME.composition['id']).blur();d.keyboard.Close();if(d.glob.features['keyboard'])d.keyboard.Execute();}else{try{if(document.getElementById(d.user.WIME.composition['id'])){document.getElementById(d.user.WIME.composition['id']).focus();}}catch(e){}}}},InsertGaiji:function(str,target,code,all){target=target?target:d.glob.target['elem'];code=code?code:d.glob.code['wfa'];if(target==null)return;var val=target.value;var caret=0;str=str.replace(/<.*?>/gi,'');if(document.all){for(var i=0;i<d.glob.target['caret'];i++){caret++;if(target.value.charAt(i)=='\n'){if(d.glob['browser']=='IE8'||d.glob['browser']=='IE7'||d.glob['browser']=='IE6')
caret++;}}}else{caret=d.glob.target['caret'];}
var val2={'before':val.substr(0,caret),'after':val.substr(caret,target.value.length)};target.value=val2['before']+str+val2['after'].replace(/^\n/gi,'');if(str.length>1){d.glob.target['caret']+=2;}else{d.glob.target['caret']++;}
d.SetFontFace({target:target,fontface:d.font[code]['fontface']});d.CreateClass(target,d.font[code]['fontClass']);d.CreateClass(target,d.user.gajisClass);d.IsContinue(d.user.continuous);d.StartWFA({str:str,elem:target,code:code});d.Log('Cursor Index: '+d.glob.target['caret'],2);},ConnectMDB:function(type,query,Callback){d.SetState('Connect MDB');if(d.user['queryType']=='ajax'){var ReadyGo=function(xhr){var data=xhr.responseText;if(data){data=JSON.parse(data);data['gaiji']=data['gaiji']?data['gaiji']:[];data['similar']=data['similar']?data['similar']:[];if(data['gaiji'].length>0||data['similar'].length>0){d.glob.result['gaiji'].length=0;d.glob.result['similar'].length=0;data['similar']=data['similar'].join('');data['similar']=data['similar'].split('');for(var i=0;i<data['gaiji'].length;i++){d.glob.result['gaiji'][i]=data['gaiji'][i];}
var j=0;for(var i=0;i<data['similar'].length;i++){if(d.Is4byte(data['similar'][i]+data['similar'][i+1])!=false){d.glob.result['similar'][j]=data['similar'][i]+data['similar'][i+1];i++;}else{d.glob.result['similar'][j]=data['similar'][i];}
j++}
Callback(d.glob.result);}else{if(type==='wime')d.CreateClass(document.getElementById(d.user.WIME['windowID']),d.user.WIME['errorClass']);if(type==='ppwime')Callback({gaiji:[],similar:[]});d.Log('Can Not Find Data',2);}
d.SetState('Finish');}else{if(type==='wime')d.CreateClass(document.getElementById(d.user.WIME['windowID']),d.user.WIME['errorClass'])
if(type==='ppwime')Callback({gaiji:[],similar:[]});d.Log('Can Not Find Data',2);}}
query['json']=query['json']?JSON.stringify(query['json']):[];d.SendXmlHttpRequest(query['url'],'POST',true,query['json'],ReadyGo);d.Log('ConnectMDB: '+query['json'],1);}else{d.InsertScript('javascript',query,d.user.queryMDB['id']);d.Log('queryMDB Query: '+query,1);if(d.user.queryMDB.format=="json"){var http=new XMLHttpRequest();http.open('HEAD',query,false);http.send();if(http.status==404){d.glob['queryState']=true;}}
dynaRequire.ReadyGo(function(){d.glob['queryState']=false;d.SetState('Finish');if(d.glob.result['gaiji'].length<=0&&d.glob.result['similar'].length<=0){if(type==='wime')d.CreateClass(document.getElementById(d.user.WIME['windowID']),d.user.WIME['errorClass']);if(type==='ppwime')Callback(d.glob.result);d.Log('We did not find results',2);}else{var data={'gaiji':[],'similar':[]}
var result={'gaiji':[],'similar':[]}
data['gaiji']=d.glob.result['gaiji'];data['similar']=d.glob.result['similar'];data['similar']=data['similar'].join('');data['similar']=data['similar'].split('');for(var i=0;i<data['gaiji'].length;i++){result['gaiji'][i]=data['gaiji'][i];}
var j=0;for(var i=0;i<data['similar'].length;i++){if(d.Is4byte(data['similar'][i]+data['similar'][i+1])!=false){result['similar'][j]=data['similar'][i]+data['similar'][i+1];i++;}else{result['similar'][j]=data['similar'][i];}
j++}
d.glob.result=result;Callback(d.glob.result);}},function(){if(d.glob['queryState']===true){return true;}else{return false;}});}},IsHere:function(type){switch(type){case'keyboard':return document.getElementById(d.Rename('temp',d.user.keyboard['id']))?true:false;break;case'wime':return document.getElementById(d.Rename('temp',d.user.WIME['id']))?true:false;break;case'candidate':return document.getElementById(d.Rename('temp',d.user.WIME.candidate['id']))?true:false;break;case'ppwime':return document.getElementById(d.Rename('temp',d.user.PPWIME['id']))?true:false;break;}
return false},Close:function(){if(d.glob.features['wime']==true){d.keyboard.Close();d.candidate.Close();d.wime.Close();}
if(d.glob.features['ppwime']==true){d.ppwime.Close();}
d.trigger.Close();},GetPosition:function(elem,top,left){var offset=d.Offset(elem);return{'top':offset['top']+top+'px','left':offset['left']+left+'px'}},Hotkey:function(event,hotkey){d.Log('## Hotkey',3);if(!d.glob.features['wime']&&!d.glob.features['ppwime'])return;var e=event||window.event;var target=e.target||e.srcElement;var key=d.GetKeyCode(e);var imeHotkey=target!='body'?(d.glob.features['wime']?d.user.IME[d.user['lang']]:{}):{};hotkey=d.extend(true,d.user['hotkey'],hotkey,imeHotkey);if(e.type=='keydown'){d.Log(' + Press: '+key,2);for(var i=0;i<d.glob['hotkey'].length;i++){if(d.glob['hotkey'][i]==17||d.glob['hotkey'][i]==18){if(d.user.prevent==true)d.PreventDefault(e);}}
if(key==229){d.glob['hotkey229']=true;}else{d.glob['hotkey'].push(key);}}else if(e.type=='keyup'){if(d.glob['hotkey229']==true){d.glob['hotkey'].push(key);d.glob['hotkey229']=false;}
d.glob['hotkey']=d.DeleteDuplicates(d.glob['hotkey']);for(var i in hotkey){if(d.user.prototypeDebug==true&&!hotkey.hasOwnProperty(i))continue;if(hotkey[i]['enable']){for(var j=0;j<hotkey[i]['hotkey'].length;j++){if(hotkey[i]['hotkey'][j]==d.glob['hotkey'][j]){if(j+1==hotkey[i]['hotkey'].length){d.Log(' + Hotkey: '+d.glob['hotkey'],1);hotkey[i]['callback']();}
continue;}else{break;}}}}
d.glob.hotkey[key]=false;d.glob.hotkey.length=0;}}});d.extend({Initialize:function(){d.glob.features=d.GetFeatures();if(d.glob.features['wime']===true){d.user.imeNewCSS['enable']=(d.user.webFullCSS||d.user.imeFullCSS)?false:d.user.imeNewCSS['enable'];d.user.inputFlowCaret=(d.glob.devices=='MOBILE'||d.user.mobileMode==true)?false:d.user.inputFlowCaret;}
d.InsertScript('css',d.glob['url']+d.user.cssPath+d.user.defaultCSS['filename'],d.user.defaultCSS['id']);if(d.glob.devices=='MOBILE'||d.user.mobileMode==true)d.InsertScript('css',d.glob['url']+d.user.cssPath+d.user.mobileCSS['filename'],d.user.mobileCSS['id']);if(d.glob.features['unicode']===true)d.mapping['unicode']=(d.mapping['unicode']!=null?d.mapping['unicode']:(d.user['compatibilityDebug']?(typeof(JSON)!='undefined'?JSON:d.mapping['unicode']):d.mapping['unicode']));if(dynaRequire.file['json']){if(dynaRequire.compatibility==true){if(d.user['compatibilityDebug']==true){JSON=dynaJSON;}}}
if(d.glob.browser=='FIREFOX'&&(document.characterSet.toUpperCase()=='BIG5'||document.characterSet.toUpperCase()=='BIG5-HKSCS')){if(d.glob.features['uao']===true){var node=d.GetNode('uao',d.DOM('body'));var elem=node.elem;d.FirefoxUAO(elem,'uao');}}
if(d.glob.browser=='CHROME'&&(document.characterSet.toUpperCase()=='BIG5'||document.characterSet.toUpperCase()=='BIG5-HKSCS')){if(d.glob.features['hkscs']===true){var node=d.GetNode('hkscs',d.DOM('body'));var elem=node.elem;d.FirefoxUAO(elem,'hkscs');}}
d.font=[];d.font.length=0;delete d.glob.gaiji;d.glob.gaiji=[];delete d.glob.count;d.glob.count={};d.SetState('Finish');d.StartGWS();},StartGWS:function(event){d.SetState('Start GWS');for(var i in d.user.font){if(d.user.prototypeDebug==true&&!d.user['font'].hasOwnProperty(i))continue;d.glob.fullGaiji[i]=d.glob.fullGaiji[i]?d.glob.fullGaiji[i]:(d.user.webFullCSS?true:false);d.glob.code['wfa']=i;d.font[i]={fontFN:d.user.font[i]['fontFN'],ignore:d.user.font[i]['ignore'],fontface:d.glob.fullGaiji[i]?d.user.font[i]['fontface']:d.user.font[i]['fontface'],fontClass:d.user.sign['dcw']+d.user.sign['font']+d.user.font[i]['fontface']+'CSS',fontID:d.user.sign['dcw']+d.user.font[i]['fontface']+'ID',mdb:d.user.font[i]['mdb']?d.user.font[i]['mdb']:d.user.font[i]['fontface'],range:d.user.font[i]['range'],object:i==d.user.code['wfa']?(d.user.font[i]['object']?d.user.font[i]['object']:'body'):(d.user.font[i]['object']?d.user.font[i]['object']:'')}
d.glob.ignore=d.GetIgnore();if(typeof(d.font[i]['object'])=='string')d.font[i]['object']=d.DOM(d.font[i]['object']);if(!document.getElementById(d.font[i]['fontID']))d.InsertScript('css',d.glob['url']+d.user.cssPath+'untitle.css',d.font[i]['fontID']);if(d.glob.features['wfa']){d.StartWFA({elem:d.font[i]['object']});}
if(typeof(d.glob.count[i])=='undefined')d.glob.count[i]=0;if(d.user.emluator.enable==true){d.SetTemplate('add','copy');}}
d.glob.code={'wfa':d.user.code['wfa'],'wime':d.user.code['wime'],'ppwime':d.user.code['ppwime']}
startTrigger.Initialize();ready.setting={enable:d.user.ready['enable']}
ready.Initialize();d.CreateEvent(window,'keyup',d.Hotkey);d.CreateEvent(window,'keydown',d.Hotkey);if(d.glob.features['wime']&&d.user.imeNewCSS['enable']){if(!document.getElementById(d.user.imeNewCSS['id']))d.InsertScript('css',d.glob['url']+d.user.cssPath+'untitle.css',d.user.imeNewCSS['id']);}
if(d.glob.features['ppwime']){if(!document.getElementById('dcw-strokeID'))d.InsertScript('css',d.glob['url']+d.user.cssPath+'stroke.css','dcw-strokeID');}
if(d.user.downList['enable']==true){if(d.glob['browser'].indexOf('IE')>=0){d.StartDownList(d.DOM('body'),d.font[d.glob.code['wfa']]['fontface']);}}
d.CreateEvent(document.body,'copy',d.Copy);},Debounce:function(callback,delay,context){if(typeof(callback)!=='function'){return;}
delay=delay||150;context=context||null;var timeout;var runIt=function(){callback.apply(context);};return(function(){window.clearTimeout(timeout);timeout=window.setTimeout(runIt,delay);});},PlaceCaret:function(caret,elem){var start=caret;var end=caret;if(window.getSelection&&document.createRange){var charIndex=0,range=document.createRange();range.setStart(elem,0);range.collapse(true);var nodeStack=[elem],node,foundStart=false,stop=false;while(!stop&&(node=nodeStack.pop())){if(node.nodeType==3){var nextCharIndex=charIndex+node.length;if(!foundStart&&start>=charIndex&&start<=nextCharIndex){range.setStart(node,start-charIndex);foundStart=true;}
if(foundStart&&end>=charIndex&&end<=nextCharIndex){range.setEnd(node,end-charIndex);stop=true;}
charIndex=nextCharIndex;}else{var i=node.childNodes.length;while(i--){nodeStack.push(node.childNodes[i]);}}}
var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);}else if(document.selection){var textRange=document.body.createTextRange();textRange.moveToElementText(elem);textRange.collapse(true);textRange.moveEnd('character',end);textRange.moveStart('character',start);textRange.select();}},DeleteEmluator:function(){var dom=d.DOM('dcw-emluator','class');for(var i in dom){if(d.user.prototypeDebug==true&&!dom.hasOwnProperty(i))continue;d.DeleteClass(dom[i],'dcw-emluator','');}
d.glob.emluator.length=0;d.SetTemplate('remove','emluator');},StartEmluator:function(){if(d.user.emluator['enable']==true){for(var i in d.user.trigger.node){var elem=d.GetNodeType(d.user.trigger.node[i]);d.OpenEmluator(d.font[d.glob.code['wfa']]['object'],elem['node'],elem['type']);}}},OpenEmluator:function(elem,nodeName,type){var node=d.GetNode('all',elem);node['elem']=d.SelectByNodeName(nodeName,node['elem'],type);node['elem']=d.DeleteDuplicates(node['elem']);for(var i in node['elem']){for(var j in d.glob.emluator){var emluator=d.glob.emluator[j];if(emluator.setting['sample']==node['elem'][i]){if(d.user.emluator.insert=='template')emluator.SetPosition();emluator.Sample2Mirror();}}}
for(var i in node['elem']){if(d.user.prototypeDebug==true&&!node['elem'].hasOwnProperty(i))continue;if(d.GetClass(node['elem'][i],'dcw-emluator','fuzzy'))continue;if(d.GetClass(node['elem'][i],d.font[d.glob.code['wfa']]['fontClass'],'fuzzy')){var emluator=d.emluator.Initialize({setting:{sample:node['elem'][i]}});emluator.Create();emluator.Handlers();d.glob.emluator.push(emluator);d.StartWFA();startTrigger.Initialize();}}},emluator:{setting:{},Sample2Mirror:function(){if(this.setting['sample'].value!=this.setting['mirrorText']){if((this.setting['sample'].nodeName).toUpperCase()=='INPUT'){this.setting['mirror'].innerText=this.setting['sample'].value;this.setting['mirrorText']=this.setting['sample'].value;}
if((this.setting['sample'].nodeName).toUpperCase()=='TEXTAREA'){this.setting['mirror'].innerText=this.setting['sample'].innerText
this.setting['mirrorText']=this.setting['sample'].innerText;}}},Mirror2Sample:function(){if(d.user['showType']=='span'){if(this.setting['mirrorText']!=d.ClearU3000(this.setting['mirror'].innerText)){var filter=d.Filter(this.setting['mirror'].innerText);var caret=d.GetCaret(this.setting['mirror'])['start'];this.setting['mirror'].innerHTML=filter;d.PlaceCaret(caret,this.setting['mirror'])}}
if((this.setting['sample'].nodeName).toUpperCase()=='INPUT'){this.setting['sample'].value=d.Pic2Str(this.setting['mirror'].innerHTML);this.setting['mirrorText']=this.setting['sample'].value;}
if((this.setting['sample'].nodeName).toUpperCase()=='TEXTAREA'){this.setting['sample'].innerHTML=d.Pic2Str(this.setting['mirror'].innerHTML);this.setting['mirrorText']=this.setting['sample'].innerText;}},SetPosition:function(){var pos=d.GetPosition(this.setting['sample'],0,0);this.setting['mirror'].style.position='absolute';this.setting['mirror'].style.top=pos['top'];this.setting['mirror'].style.left=pos['left'];},Handlers:function(){this.setting['mirror'].setting=this.setting;d.CreateEvent(this.setting['mirror'],'keyup',this.Mirror2Sample);d.CreateEvent(this.setting['mirror'],'copy',d.Copy);d.CreateEvent(this.setting['mirror'],'paste',d.Paste);if(this.setting['sample'].nodeName=='INPUT')d.CreateClass(this.setting['mirror'],'dcw-single');d.SaveEvent(this.setting['mirror'],this.setting['sample']);},Create:function(){var mirror=document.createElement('div');mirror.className='dcw-emluator-input';mirror.style.width=this.setting['sample'].offsetWidth+'px';mirror.style.height=this.setting['sample'].offsetHeight+'px';if(this.setting['sample'].nodeName=="INPUT")mirror.style.lineHeight=this.setting['sample'].offsetHeight+'px';mirror.style.display=this.setting['sample'].style.display||'inline-block';if(this.setting['sample'].getAttribute("readonly")){}else{mirror.setAttribute('contenteditable',true);}
mirror.innerHTML=this.setting['sample'].value||this.setting['sample'].innerHTML;if(d.user.emluator.insert=='html')d.InsertAfter(this.setting['sample'],mirror)
if(d.user.emluator.insert=='template'){d.SetTemplate('add','emluator',mirror);this.SetPosition();}
this.setting['mirrorText']=mirror.innerText;this.setting['mirror']=mirror;d.CreateClass(this.setting['sample'],'dcw-emluator');if(typeof(this.setting['sample'].type)!='undefined'){if(d.user.emluator.insert=='html')this.setting['sample'].style.display='none';if(d.user.emluator.insert=='template')this.setting['sample'].style.visibility='hidden';}
if(d.user['showType']=='string'){this.setting['mirror'].innerHTML=mirror.innerText;d.CreateClass(this.setting['mirror'],'dcw-emluator-input');d.CreateClass(this.setting['mirror'],d.font[d.glob.code['wfa']]['fontClass']);}
d.CreateClass(this.setting['mirror'],d.user.gajisClass);},Initialize:function(setting){var emluator={};d.extend(true,emluator,d.emluator,setting);return emluator;}},InsertWrapper:function(elem,wrapper){if(typeof(wrpper)=='undefined'){var wrapper=document.createElement('div')}
wrapper.appendChild(elem.cloneNode(true));elem.parentNode.replaceChild(wrapper,elem);return wrapper;},StartDownList:function(elem,fontface){var node=d.GetNode('all',elem);var elem=d.DOM('.dcw-select-button');if(elem.parentNode)elem.parentNode.removeChild(elem);if(elem.length>0){for(var i=0;i<elem.length;i++){if(elem[i].parentNode){elem[i].parentNode.removeChild(elem[i]);}}}
var elem2=d.DOM('.dcw-select-view');if(elem2.length>0){for(var i=0;i<elem2.length;i++){if(elem2[i].parentNode){elem2[i].parentNode.removeChild(elem2[i]);}}}
node['elem']=d.SelectByNodeName('select',node['elem']);node['elem']=d.DeleteDuplicates(node['elem']);for(var i in node['elem']){if(d.user.prototypeDebug==true&&!node['elem'].hasOwnProperty(i))continue;if(d.GetClass(node['elem'][i].parentNode,'dcw-select-emluator')==true){var downList=d.downList.Initialize({elem:node['elem'][i],fontface:fontface});downList.Create();downList.Handlers();}}},downList:{wrap:{},option:{},o:{},f:{Select:function(event){var e=event||window.event;var target=e.target||e.srcElement;this.o.elems.selectedIndex=target.getAttribute('data-value');this.o.view.style.fontFamily='dcw-stroke';if(d.glob.browser=="IE8"||d.glob.browser=="IE7")this.o.view.value=target.innerHTML;d.DeleteEvent(this.wrap,'mouseleave',this.f.Close);this.f.Close(this);},Close:function(self){if(typeof(event)!='undefined'&&typeof(window.event)!='undefined'){var e=event||window.event;var target=e.target||e.srcElement;}
self=self.type?this:self;if(self.o.wrap.parentNode!=null)self.o.wrap.parentNode.removeChild(self.o.wrap);}},SetPosition:function(target,elem){var p=d.GetPosition(elem,0,0);target.style.position='absolute';target.style.top=p['top'];target.style.left=p['left'];},CreateChild:function(){var elem=this.elem;var options=[];var wrap=document.createElement('div');wrap.className='dcw-select-wrap';d.CreateClass(wrap,'dcw-noSearch');wrap.style.width=elem.offsetWidth+'px';for(var i=0;i<elem.options.length;i++){options[i]=document.createElement('div');options[i].className='dcw-select-option';options[i].innerHTML=elem.options[i].value;options[i].style.fontFamily=elem.style.fontFamily;options[i].setAttribute('data-value',i);wrap.appendChild(options[i]);this.option=options[i];this.option.o=this.o;this.option.f=this.f;this.option.o.elems=elem.options;this.option.o.wrap=wrap;this.option.o.button=this;d.CreateEvent(this.option,'mouseup',this.option.f.Select);}
if(d.GetClass(this.elem.parentNode,"dcw-select-emluator")){this.elem.parentNode.appendChild(wrap);}else{this.SetPosition(wrap,elem);document.body.appendChild(wrap);}
this.wrap=wrap;this.wrap.o=this.o;this.wrap.f=this.f;this.wrap.o.wrap=wrap;d.CreateEvent(this.wrap,'mouseleave',this.wrap.f.Close);},Handlers:function(){d.extend(true,this.button,this);d.CreateEvent(this.button,'click',this.CreateChild);},Extend:function(elem){d.extend(true,elem,this);},Create:function(){var button=document.createElement('div');button.className='dcw-select-button',button.style.width=this.elem.offsetWidth+'px';button.style.height=this.elem.offsetHeight+'px';button.style.zIndex='10001';var view=document.createElement('input');view.style.width=this.elem.offsetWidth+'px';view.style.height=this.elem.offsetHeight+'px';view.readonly=true;view.style.fontFamily=this.elem.style.fontFamily;d.CreateClass(view,'dcw-select-view');d.CreateClass(view,'dcw-noSearch');if(d.glob.browser=="IE8"||d.glob.browser=="IE7")view.value=this.elem.value;button.o=this.o;button.o.view=view;if(d.GetClass(this.elem.parentNode,"dcw-select-emluator")){this.elem.parentNode.appendChild(button);this.elem.parentNode.appendChild(view);}else{this.SetPosition(this.button,this.elem);document.body.appendChild(button);this.SetPosition(this.view,this.elem);document.body.appendChild(view);}
this.button=button;},Initialize:function(setting){var downList={};d.extend(true,downList,d.downList,setting);return downList;}},ready:{setting:{enable:true},Open:function(){d.Log('### Open',3);if(!document.getElementById(d.Rename('temp',d.user.ready['id'])))d.SetTemplate('add',d.user.ready['id']);if(d.user.ready['postion']!==false)d.CreateEvent(window,'resize',ready.SetPosition);},Close:function(){d.Log('### Close',3);d.DeleteEvent(window,'resize',ready.SetPosition);d.SetTemplate('remove',d.user.ready['id']);},Set:function(){d.Log('### Set',3);d.SetTemplate('show',d.user.ready['id']);if(d.user.ready['postion']!==false)ready.SetPosition();},SetPosition:function(){d.Log('### SetPosition',3);d.SetMirrorsPosition({elem:[document.getElementById(d.user.ready['id'])],target:d.glob.target['elem'],align:d.user.ready['align'],position:d.user.ready['position'],top:d.user.ready['top'],left:d.user.ready['left'],bottom:d.user.ready['bottom'],right:d.user.ready['right']});},Initialize:function(){d.Log('### Initialize',3);if(ready.setting['enable']===false||d.glob['devices']=='MOBILE'||d.user.mobileMode==true)return;ready.Open();ready.Set();}},startTrigger:{Open:function(){d.Log('### Open',3);var elem=d.GetForm(d.font[d.glob.code['wfa']]['object']);var elem2=[];if(elem != null)for(var i=0;i<elem.length;i++){if(d.GetClass(elem[i],d.user.trigger.sign,'fuzzy')==false){d.CreateClass(elem[i],d.user.trigger.sign)
elem2.push(elem[i]);}}
d.CreateMuchEvent.call(this,{'node':elem2,'keydown':startTrigger.Execute,'keyup':startTrigger.Execute,'click':startTrigger.Execute,'blur':startTrigger.Scan,'change':startTrigger.Scan});},Close:function(){d.Log('### Close',3);var elem=d.GetForm(d.font[d.glob.code['wfa']]['object']);var elem2=[];for(var i=0;i<elem.length;i++){if(d.GetClass(elem[i],d.user.trigger.sign,'fuzzy')==true){d.CreateClass(elem[i],d.user.trigger.sign)
elem2.push(elem[i]);}}
d.DeleteEvent(window,'keyup',d.Hotkey);d.DeleteEvent(window,'keydown',d.Hotkey);d.DeleteMuchEvent.call(this,{'node':elem2,'keydown':startTrigger.Execute,'keyup':startTrigger.Execute,'click':startTrigger.Execute,'blur':startTrigger.Scan,'change':startTrigger.Scan});},Scan:function(event){d.Log('### Scan',3);var e=event||window.event;var target=e.currentTarget||e.srcElement;var key=d.GetKeyCode(e);if(d.user['scan']=='delay'){clearTimeout(d.glob['startWFA']);d.glob['startWFA']=setTimeout(function(){d.StartWFA({elem:target});},1000);}else if(d.user['scan']=='blur'){if(e.type=='blur '||e.type=='change')
d.StartWFA({elem:target});}else if(d.user['scan']=='keyup'){if(e.type=='keyup')d.StartWFA({elem:target});}},Execute:function(event){d.Log('### Execute',3);var e=event||window.event;var target=e.target||e.srcElement;if(d.glob.features['wfa'])startTrigger.Scan(event);if(d.glob.features['wime']){if(target.nodeName.toUpperCase()=='INPUT'&&(target.type).toUpperCase()!='TEXT')return;if(e.type=='keyup'){d.Hotkey(event);if(e.shiftKey){if(d.glob['devices']==='DESKTOP'&&d.user.mobileMode!=true){if(d.GetClass(d.glob.target['elem'],d.user.targetClass,'fuzzy')){var ime=d.GetIME(d.glob.target['elem'],d.user.targetClass);var key=d.GetKeyCode(e);d.OpenWIME(ime,'show',e)}}}
if(target==d.glob.target['elem']){if(((target.nodeName).toUpperCase()=='INPUT'&&(target.type).toUpperCase()=='TEXT')||(target.nodeName).toUpperCase()=='TEXTAREA'){d.glob.target['elem']=target;d.glob.target['caret']=d.GetCaret(target)['start'];}}}else if(e.type=='keydown'||e.type=='click'){d.Hotkey(event);if(target==d.glob.target['elem']||target==document.getElementById(d.user.WIME['compositionID'])){if(target==d.glob.target['elem']){d.glob.target['caret']=typeof(d.GetCaret(target)['start'])!=='undefined'?d.GetCaret(target)['start']:d.glob.target['caret'];}
if(d.glob.features['keyboard']){d.keyboard.Close();d.keyboard.Execute();}
if(e.type=='keydown'){if(d.glob['devices']==='DESKTOP'&&d.user.mobileMode!=true){if(d.GetClass(d.glob.target['elem'],d.user.targetClass,'fuzzy')){if(e.shiftKey){if(d.user.prevent==true)d.PreventDefault(e,'all');}else{var ime=d.GetIME(d.glob.target['elem'],d.user.targetClass);var key=d.GetKeyCode(e);var Func=function(){if(key!==8&&key!==9&&key!==16&&key!==13&&key!==17&&key!==18&&key!==27&&key!==37&&key!==38&&key!==39&&key!==40&&d.glob.hotkey.length<2){d.OpenWIME(ime,'show');}}
if(d.user.ime2English['enable']==true){if((key==0||key==229)&&key!=13){if(d.glob.ime2English==false){alert(d.user.ime2English['message'][d.user.lang]);d.glob.ime2English=true;}}else{Func();}}else{Func();}}}}}
if(e.type=='click'){d.Close();}}else{d.Close();if(((target.nodeName).toUpperCase()=='INPUT'&&(target.type).toUpperCase()=='TEXT')||(target.nodeName).toUpperCase()=='TEXTAREA'){d.glob.target['elem']=target;d.glob.target['caret']=d.GetCaret(target)['start'];}}
if(!d.GetClass(d.glob.target['elem'],d.user.targetClass,'fuzzy')){trigger.setting={enable:d.user.trigger['enable']}
trigger.Initialize();}}}},Initialize:function(){d.Log('### Initialize',3);if(d.user.trigger.execute==false)return;startTrigger.Open();}},trigger:{setting:{enable:true},Open:function(){d.Log('### Open',3);if(!document.getElementById(d.Rename('temp',d.user.trigger['id'])))d.SetTemplate('add',d.user.trigger['id']);if(d.user.trigger['postion']!==false)d.CreateEvent(window,'resize',trigger.SetPosition);},Close:function(){d.Log('### Close',3);d.DeleteEvent(window,'resize',trigger.SetPosition);d.SetTemplate('remove',d.user.trigger['id']);},Set:function(){d.Log('### Set',3);d.SetTemplate('show',d.user.trigger['id']);if(d.user.trigger['postion']!==false)trigger.SetPosition();},SetPosition:function(){d.Log('### SetPosition',3);d.SetMirrorsPosition({elem:[document.getElementById(d.user.trigger['id'])],target:d.glob.target['elem'],align:d.user.trigger['align'],position:d.user.trigger['position'],top:d.user.trigger['top'],left:d.user.trigger['left'],bottom:d.user.trigger['bottom'],right:d.user.trigger['right']});},Initialize:function(){d.Log('### Initialize',3);if(trigger.setting['enable']===false&&d.glob['devices']!='MOBILE'&&d.user.mobileMode!=true)return;trigger.Open();trigger.Set();}}});d.extend({user:{lang:'JPN',keyboard:{},code:{'wfa':1,'wime':1,'ppwime':1},font:{1:{fn:'gaijis.tte',fontface:'dcw-gaijis',object:'body'}},saveEvent:['change','click','focus','blur'],defaultFontFace:false,hotkey:{},downList:{enable:false},defaultCSS:{id:'dcw-style',filename:'gws.css'},mobileCSS:{id:'dcw-style-mobile',filename:'gws-mobile.css'},sign:{dcw:'dcw-',font:'font-',temp:'temp-'},stateID:'dcw-state',noListenClass:['dcw-noSearch','dcw-candidate-str'],passHidden:false,noChildClass:'dcw-noChildClass',gajisClass:'dcw-hasGaiji',hideClass:'dcw-base-hide',isDebug:true,logLevel:1,compatibilityDebug:true,configVersion:'Standard',unicode2big5:{enable:true,remove:true,action:'alert',message:{'ENG':'This isn\'t big5 character, please create this character.','CHT':'下列文字非big5編碼文字，請在造字系統創造該字。','JPN':''}},scan:'blur',uao2gaiji:true,hkscs2gaiji:true,webFullCSS:false,imeFullCSS:false,showType:'string',cssPath:'lib/css/',mdbPath:'imequery/',fontPath:'outline_sin/',imgPath:'lib/imgs/fontImg_sin/',cssTempPath:'lib/css/temp/',preprocessor:'.aspx',preprocessorPath:'socket/',socket:{id:'dcw-socketID',filename:'wfc_socket'},pngPath:'/gws/outline/wfc/',prototypeDebug:true,queryType:'query',node:['input[type=text]','textarea'],bufferTime:1000,bufferCount:500,mobileMode:false,overflowCenter:true,ready:{enable:false,id:'dcw-ready',align:'body',position:'bottom-left',top:0,left:0},trigger:{execute:true,enable:false,node:['input[type=text]','textarea'],sign:'dcw-trigger-class',id:'dcw-trigger',align:'target',position:'bottom-left',top:5,left:0},prevent:false,emluator:{enable:false,insert:'html'}}});d.extend(true,d.user,{queryMDB:{id:'dcw-queryID',format:'mdb',filename:'wfc_mdb'}});d.extend({glob:{downList:[],emluator:[],ignore:[],ime2English:false,replayCount:0,stateLog:[],fullGaiji:{},fontID:null,code:{'wfa':null,'wime':null,'ppwime':null},statle:null,result:{'gaiji':[],'similar':[]},target:{},browser:dynaRequire.GetBrowser()['browser'],devices:dynaRequire.GetBrowser()['devices'],shift:null,features:{wfa:null,uao:null,unicode:null,wime:null,ppwime:null},gaiji:{}}});d.extend({lang:{CHT:{search:'搜尋'},JPN:{search:'検索'}},html:{},mapping:{uao:null,hkscs:null,unicode:null,ascii2keyboard:{49:'1',81:'q',65:'a',90:'z',50:'2',87:'w',83:'s',88:'x',69:'e',68:'d',67:'c',82:'r',70:'f',86:'v',53:'5',84:'t',71:'g',66:'b',89:'y',72:'h',78:'n',56:'8',73:'i',75:'k',188:',',57:'9',79:'o',76:'l',190:'.',48:'0',80:'p',186:';',191:'/',189:'-',85:'u',74:'j',77:'m',54:'6',51:'3',52:'4',55:'7'}}});d.extend(true,d.glob,{url:dynaRequire.GetDomain(),theProtocol:('http:'==document.location.protocol)?'http':'https',pageEncode:typeof document.charset=='undefined'?document.characterSet.toUpperCase():document.charset.toUpperCase(),fontType:d.glob['browser'].indexOf('IE')>=0?'eot':'tt',extendName:d.glob['browser'].indexOf('IE')>=0?'':'_ff'});var startTrigger=d.startTrigger;var trigger=d.trigger;var ready=d.ready;})(dynaGWS);